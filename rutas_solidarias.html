<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Rutas Solidarias IA - Demo</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      background: #f4f7fb;
    }
    h1 {
      margin-bottom: 0;
      color: #0b4f8a;
    }
    small {
      color: #555;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 13px;
    }
    th {
      background: #e6f0fa;
      text-align: left;
    }
    tr:nth-child(even) {
      background: #fafbff;
    }
    .btn {
      margin-top: 16px;
      padding: 10px 16px;
      border: none;
      background: #0b4f8a;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn:hover {
      background: #0d629f;
    }
    .badge {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      color: #fff;
    }
    .prio-alta { background: #d72638; }
    .prio-media { background: #f4a261; }
    .prio-baja { background: #2a9d8f; }
    #resultado {
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 12px 16px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      margin-top: 8px;
      font-size: 13px;
    }
    .card h3 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 15px;
      color: #0b4f8a;
    }
  </style>
</head>
<body>

  <h1>Rutas Solidarias IA</h1>
  <small>Demo con datos simulados – Logística solidaria y ayuda humanitaria en Ecuador</small>

  <p>
    Estas son comunidades afectadas tras un evento de emergencia. 
    El sistema calcula un <strong>índice de prioridad solidaria</strong> y sugiere
    un plan de rutas para dos vehículos de ayuda.
  </p>

  <table id="tabla-comunidades">
    <thead>
      <tr>
        <th>Comunidad</th>
        <th>Provincia</th>
        <th>Personas afectadas</th>
        <th>Nivel de afectación (1–5)</th>
        <th>Acceso (horas)</th>
        <th>Necesidad vital (agua/alimentos/medicinas)</th>
        <th>Índice de prioridad</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="btn" onclick="calcularPlan()">Calcular plan de ayuda</button>

  <div id="resultado"></div>

  <script>
    // Datos simulados de comunidades ecuatorianas afectadas
    const comunidades = [
      {
        nombre: "Recinto Santa Lucía",
        provincia: "Los Ríos",
        personas: 420,
        nivelAfectacion: 5,     // 1-5
        accesoHoras: 3.5,       // horas de viaje
        necesidadVital: 3       // 1: baja, 2: media, 3: alta
      },
      {
        nombre: "Barrio La Gasca",
        provincia: "Pichincha",
        personas: 310,
        nivelAfectacion: 4,
        accesoHoras: 0.5,
        necesidadVital: 3
      },
      {
        nombre: "Comunidad Río Verde",
        provincia: "Esmeraldas",
        personas: 260,
        nivelAfectacion: 4,
        accesoHoras: 2.5,
        necesidadVital: 2
      },
      {
        nombre: "Parroquia Shell",
        provincia: "Pastaza",
        personas: 180,
        nivelAfectacion: 3,
        accesoHoras: 1.8,
        necesidadVital: 2
      },
      {
        nombre: "Isla Puná",
        provincia: "Guayas",
        personas: 350,
        nivelAfectacion: 5,
        accesoHoras: 4.0,   // acceso complejo
        necesidadVital: 3
      }
    ];

    function prioridadBadge(score) {
      if (score >= 0.7) return '<span class="badge prio-alta">Alta</span>';
      if (score >= 0.45) return '<span class="badge prio-media">Media</span>';
      return '<span class="badge prio-baja">Baja</span>';
    }

    function renderTabla() {
      const tbody = document.querySelector("#tabla-comunidades tbody");
      tbody.innerHTML = "";
      comunidades.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.nombre}</td>
          <td>${c.provincia}</td>
          <td>${c.personas}</td>
          <td>${c.nivelAfectacion}</td>
          <td>${c.accesoHoras.toFixed(1)}</td>
          <td>${c.necesidadVital === 3 ? "Muy alta" : (c.necesidadVital === 2 ? "Media" : "Baja")}</td>
          <td>${c.score ? prioridadBadge(c.score) + " " + c.score.toFixed(2) : "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function calcularPlan() {
      // 1) Calcular índice de prioridad (simulación de IA)
      // Normalizaciones simples (puedes explicarlo como modelo de ML futuro)
      const maxPersonas = Math.max(...comunidades.map(c => c.personas));
      const maxAcceso   = Math.max(...comunidades.map(c => c.accesoHoras));

      comunidades.forEach(c => {
        const personasNorm = c.personas / maxPersonas;           // 0-1
        const afectacionNorm = c.nivelAfectacion / 5;            // 0-1
        const accesoNorm = c.accesoHoras / maxAcceso;            // 0-1
        const necesidadNorm = c.necesidadVital / 3;              // 0-1

        // Ponderaciones (ejemplo): afectación y necesidad pesan más
        const score =
          0.35 * afectacionNorm +
          0.30 * personasNorm +
          0.25 * necesidadNorm +
          0.10 * (1 - accesoNorm);  // mientras más difícil el acceso, sube un poco la prioridad

        c.score = score;
      });

      // 2) Ordenar por prioridad (descendente)
      comunidades.sort((a, b) => b.score - a.score);
      renderTabla();

      // 3) Asignar a vehículos (greedy simple)
      const capacidadPorCamion = 500; // kits de ayuda
      const camiones = [
        { nombre: "Camión 1", capacidadRestante: capacidadPorCamion, paradas: [] },
        { nombre: "Camión 2", capacidadRestante: capacidadPorCamion, paradas: [] }
      ];

      comunidades.forEach(c => {
        const kitsNecesarios = Math.ceil(c.personas / 4); // 1 kit por 4 personas aprox.
        let asignado = false;

        for (const camion of camiones) {
          if (camion.capacidadRestante >= kitsNecesarios) {
            camion.paradas.push({ comunidad: c, kits: kitsNecesarios });
            camion.capacidadRestante -= kitsNecesarios;
            asignado = true;
            break;
          }
        }
        if (!asignado) {
          // marcar como pendiente
          c.pendiente = true;
          c.kitsPendientes = kitsNecesarios;
        }
      });

      // 4) Mostrar resultado
      const resultadoDiv = document.getElementById("resultado");
      let html = "";

      camiones.forEach(camion => {
        html += `<div class="card">
          <h3>${camion.nombre}</h3>
          <p><strong>Capacidad usada:</strong> ${(capacidadPorCamion - camion.capacidadRestante)} / ${capacidadPorCamion} kits</p>
          <ul>`;
        camion.paradas.forEach(p => {
          html += `<li>${p.comunidad.nombre} (${p.comunidad.provincia}) – ${p.kits} kits, prioridad ${(p.comunidad.score || 0).toFixed(2)}</li>`;
        });
        html += `</ul></div>`;
      });

      const pendientes = comunidades.filter(c => c.pendiente);
      if (pendientes.length > 0) {
        html += `<div class="card">
          <h3>Comunidades aún sin cubrir</h3>
          <ul>`;
        pendientes.forEach(c => {
          html += `<li>${c.nombre} – requiere ${c.kitsPendientes} kits (prioridad ${(c.score || 0).toFixed(2)})</li>`;
        });
        html += `</ul>
          <p><em>En niveles avanzados, el sistema propondría más vehículos o una segunda ola de rutas.</em></p>
        </div>`;
      }

      resultadoDiv.innerHTML = html;
    }

    // Render inicial
    renderTabla();
  </script>

</body>
</html>
